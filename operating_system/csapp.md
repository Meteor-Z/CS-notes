# 《深入理解操作系统》总结

type: Post
status: Published
date: 2023/07/23
summary: 关于《深入理解操作系统》书籍的总结
tags: 操作系统
category: 操作系统

# 深入理解操作系统

这篇文章主要讲述的是看`深入理解操作系统`这本书籍之后总结的东西。

## 内存

内存，cpu和硬盘之间的桥梁，早期cpu运行速度慢，不需要内存，可以与硬盘之间进行直接交互，（`这里好像是不对的，但是硬盘的速度确实是慢，需要一个中间间`）但是随着cpu越来越快，导致硬盘的速度跟不上cpu的速度，于是就加入了内存，作为cpu和硬盘之间的桥梁。cpu和硬盘的相对速度几乎是呈现指数的倍数进行下降

$$
1GB = 1024MB = 1024^2KB = 1024^3 B = 1024^3 \times 8 bits
$$

其中在内存中，最小的访问单元是一个字节，也就是1B，笔记本电脑上有32位和64位系统，可以大致的表达出其中的内存寻址能力，32位是用32位二进制数来表示一个内存地址，那么对于32位，就最多表示$2^{32}$个内存地址，也就是4GB，同理，64位内存可以支持更多，但是windows系统有限制，以及传输总线，系统占用的显示，实际用不了这么多。

### 南桥北桥

在早期的电脑上，电脑上的显卡，内存等不是直接与cpu进行相连的，而是通过北桥来与电脑上的cpu进行相连，肯定会有所延迟，于是之后就淘汰了北桥，让这些重要的零件与cpu直接相连,但是南桥没有淘汰，像一些USB接口什么的，还是直接与南桥进行连接，然后与cpu进行通信连接。

### 内存类型

cpu和硬盘之间，用内存之间进行连接，但是cpu还是觉得内存不够快，于是就有了一级缓存，二级缓存，三级缓存，这些缓存和内存使用的都是同一种`RAM`,只不过缓存更少，但是速度更快，是`SRAM`,而内存主要是`DRAM`,当然这些内存都是易失去的，速度更快的`SRAM`更贵，比如我的

### 虚拟内存

虚拟内存属于操作系统和硬件的范畴，都有一定的设计，简单的系统不需要虚拟内存。

1. 物理内存的问题
    1. 内存空间不够
    2. 产生了内存碎片（？ 应该是因为物理内存是连续的，中间的内存有可能出现空隙？
    3. 没有内存保护 （ 多个程序有可能访问同一个地方，这样就寄了

计算机的任何问题都可以加入一个中间层进行解决！ （不断抽象）

1. 虚拟内存的优点
    1. 可以使用硬盘交换空间
    2. 虚拟地址到物理地址的映射就比较灵活 （不连续的空间也可以直接拿来进行映射，wc,好强）
    3. 进程和进程之间有了空间隔离 （为每一个进程都提供了一个（几乎）相同的地址空间

注意，像很多时候，你在`C/C++`中开了很大内存大小的数组，这时候并不会直接开辟，只有你使用的的时候才会进行开启，这就是你为什么你一直交题一直`mle`的原因（

### 虚拟内存如何保证内存的使用是良好的

根据程序的局部性，对于他使用的内存，每一个时刻就只会连续的访问同一块小的内存，`100%内存某一事时刻只会使用其连续的一点点内存`，将那些使用的内存（本来在硬盘上的虚拟内存）存储在内存中就好了，一般来说，这些内存的大小大约就是`4k`这么少，所以说内存使用效率就非常高。

虚拟内存可以视为在存储在硬盘中的数据的对于`DRAM`的缓存。
`一般来说，虚拟内存应该保持在物理内存的0.5-3倍左右，最好不要超过1倍`

## 链接

### 静态库和动态库

1. 静态库，其实就是`a.o` 这样的合集，合成一个静态库，然后链接到`main.o`上。
2. 动态库就是`b.a`这样的，在加载的时候加载到`main.o`上，可以减少源代码的体积和编译时间，但是缺少了那个库，那么这个代码就执行不了，对应到`Windows`上，其实就是`dll`，(建议安装C/C++ 运行库)。

## 内存对齐/数据对齐

cpu在访问硬盘上的数据的时候，一般是按照4kb的数据进行读取，(硬盘也大多数4kb的默认页分页），（这就为什么硬盘的4k读写速度很重要），所以说在C/C++中，对于结构体/类来说，sizeof() 会获取到所占的内存大小，这时候就会内存对齐，对齐原则：任意K字节的基本对象的地址必须是K的倍数，保证其起始位置是其K字节的倍数，并且还要保证数组的情况可以举出这个样的例子

```cpp
struct S1
{
    int i;
    char c;
    int j;
};

struct S2
{
    int i;
    int j;
    char c;
};
```

这里面根据内存对齐，可以知道S1的答案所占是9,但是其实是12,对于S2,9个内存都可以直接满足，但是还要考虑数组这样的情况，所以还是12