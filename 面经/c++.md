# c++ 面经

## 基础知识

### 结构体对齐讲一讲？然后int double int是多大？(24) (结构体对齐的规则有两条)

cpu读取的时候按照4k的粒度进行读取，所以结构体对齐的时候不是按照正常的排列进行的。  

对齐规则

  1. 自身对其的整数倍数的大小上，
  2. 考虑多个数组同时出现的时候，后面的也要进行考虑

### 什么时候是万能引用，什么时候是右值引用？

都是`&&`,但是还是有不同

1. 如果有类型推倒，那么才会有万能引用（universal references）
2. 如果吗没有类型推倒，那么就不是万能引用。

带入到代码中，就是 `模板`和`auto`有类型推倒  
并且必须是：`auto&&` 和 `f(T&& val)`的形式

```c++
#include <iostream>
struct Node {
    int a;
    double b;
    double c;
};
int main() {
    Node a = { 1, 2, 3 };
    Node&& b = std::move(a); // 右值引用 -> 右值
    auto&& c = a; // 万能引用 ->  左值
    auto&& d = std::move(a); // 万能引用 -> 右值
}
```

### 什么是万能引用？引用折叠是什么？完美转发是什么，参数是左值还是右值？

`std::move()`和`std::forward<T>()`仅仅是将将其进行左值变成右值，但是并没有进行移动。参数永远是左值。

### C++三种继承？ ： 就是 public protected private, private 可以用空基类优化？(protected可以避免将子类变成父类传参?，然后可以配合空基类优化)

`请使用public`进行继承，EBO可以节省一些空间。

### new一个对象在多线程的情况下是安全的么？new(delete)的底层是什么？

1. 调用 `operator() new`进行构造一个空的地方
2. 调用构造函数进行赋值
3. 指针传给调用者

析构函数是反过来的

### 单例模式？

[更好的单例模式](https://zhuanlan.zhihu.com/p/651173499)

### 智能指针是线程安全的么？为什么更推荐使用make_unique/shared() ?

是线程安全的  
防止多个智能指针同时使用同一个指针构造，导致多次构造等

### namespace {} 这样是干什么的 (就是没有名字的namespace)


- 虚函数存放在哪里？虚函数表存放在哪里？（elf文件里面想）
- 虚函数表是在什么时候生成的? (编译期？运行期？) (编译期)
- 构造函数为什么不能是虚函数？[知乎](https://www.zhihu.com/question/35632207)
- shared_ptr也有什么样的缺点（延长生命周期方面）
- RAII(资源获取即初始化)每一个明确的资源配置动作（new）都应该在`单一语句`中执行，并且立即将获得的资源交给handle对象(智能指针)
- 指针和引用有什么区别？类中可以直接使用引用么？推荐使用？ 什么时候用指针，什么时候用引用 ？（延迟初始化）
- TCP连接的时候什么时候才会触发三次握手？
- c++中四种cast是什么
  - dynamic_cast 转换失败会干什么？ 两种情况？ 依赖与什么？有性能损耗么？和static_cast有什么区别？
  - const_cast
  - static_cast
  - reinterpret_cast
- STL底层的数据结构都是什么数据结构？ 有序的和无序的都是什么？
- sizeof运算符是什么阶段生效的，里面的函数会发生实际作用吗？
- std::move(a),这样会发生一个移动么？实际上发生了什么？
- 为什么单例模式需要通过静态函数创建实例 不能直接一个全局变量或者全部静态方法静态变量？ （链接顺序，已经初始化，空间占用）
- 为什么链接的时候需要保证初始化顺序（在操作系统里面有写到）
- std::enable_shared_from_this是干什么的？(在tiny_rpc项目里面写有)
- 序列化和反序列化是什么？（可能在redis上进行实现）
- 什么是复杂均衡
- gdb调试
- 浮点数存储原理
- epoll的堵塞？
- 一句话总结多态的概念

## 多线程

- 条件变量和信号量有什么区别（我怎么感觉都用条件变量就可以了）
- 如何实现一个十分安全的条件变量？()

## 实现

- 如何实现一个循环引用？(shared_ptr)

## rpc

- rpc是什么，为什么需要rpc

## 设计模式

- 什么是生产者-消费者模式
