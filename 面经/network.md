# network

## 因为TCP端口号是16位无符号整数，最大是65536，所以计算机中最多65536的socket连接

并不是的，Tcp连接的时候是四元组，大致是(源ip地址，源端口，目的ip地址，目的端口)
因为是四元组，如果有一个不一样，那么就是不一样的连接，

考虑到一台机器，有一个ip地址（里面是一个tcp服务程序），只监听一个端口，理论上会有多少个tcp连接）
因为是四元组，那么考虑ipv4的话，那么就是$2^48$，$2^32 * 2^16$次方，32是ip地址， 16是TCP端口号。

## TCP/UDP这些在运输层的协议，会保证数据的安全么？ 发明了什么进行防御

首先，TCP只是保证数据能够安全到达你的手上，但是并不能保证数据被修改过的痕迹。所以数据到达的时候会要进行验证

UDP几乎建立在IP协议上，几乎没有干过任何事情
但是TCP加入了很多机制去保护这个数据不会受损：（待补充）

## http1.0, http1.1, http2.0 的区别是什么？

- 都是以tcp协议为基层
- http/1.1引入了长连接，减少了建立和关闭连接的消耗和延迟
  - 若干个请求排队串行化单线程进行处理，可能会有线头堵塞
- http/2.0引入了多路复用，提高了连接的利用率
  - 可在一个连接上并行执行，带单个连接上同时发送多个多个请求相应，
  - 头部压缩
  - 二进制协议，HTTP1.0是文本协议，HTTP2.0是二进制协议

## http 和 https 有什么区别？

https经过了加密，使用的是`TLS/SSL`技术进行加密
公钥和私钥进行加密，是非对称加密，其中还有CA机构什么的，有空抓门写一个文章讲讲

## select poll epoll的总结

### select 的缺陷

- fd集合是一个数组，每次使用都会将其从用户态拷贝到内核态，耗费时间
- 数组需要便利，浪费时间
- 文件描述符是1024,不够大

poll其实就是突破了文件描述符的最大限制,并且固定大小的集合换成了由链表实现的动态数组。但是还是受文件描述符的限制。

### 对于epoll

- 将用户关心的文件描述符事件存放在内核中，通过内存映射，在用户态进行访问，（重复拷贝是利用mmap这样的技术来实现避免拷贝
- 将事件（回调函数）加入到就绪列表中，调用`epoll_wait`就可以检查是否有多于的fd,然后给用户就可以了

### 工作模式

- LT模式：默认的工作模式，检测触发的时候，不会立刻处理事件，放到就绪列表中，下次使用，再通知
- ET模式：必须要处理，下次调用的时候，不会再次相应（只支持非堵塞模式），

## 当浏览器输入网址之后回车进入到网页渲染完毕之后会发生什么？

1. 网页开始通过域名开始查找对应的ip地址号，
   1. 受限查看的就是hosts里面的东西，linux上和win上都有，linux在`/etc/hosts`上面
   2. 如果没有，可以去发送dns请求到本地dns服务器，查询缓存，
   3. 访问根服务器，这里会进行一系列的递归查找，递归查找结束之后就会返回给电脑
2. 浏览器得到ip地址之后，就会向web服务器发送http请求，然后tcp三次握手连接。
3. 网页浏览器得到数据开始渲染页面。
4. http会进行一定的连接（长连接），然后会进行tcp四次挥手断开连接。

## tcp中有粘包的问题么？

tcp属于传输层的协议，基于字节流而不是信息包的协议，将数据变成字节流发送到另一端，而且保证了数据不会乱，但是你要按照你的逻辑将字节流进行解析出来，（数据会根据端口号来将数据发送给客户端，但是你需要自己设计协议来将数据协议。否则就寄了。那么问题就转换成了`如何设计应用层协议的问题`

## 我的程序有时候非正常断开，绑定了同一个端口，但是重启，我的端口还是占用，这是怎么回事？

端口处于`time_wait`状态, 就是计网里面四次挥手的最后`Time_wait`，linux上大约是是2个msl,也就是2 * 30 ms = 1min 的时间，处于这个状态，于是就不能连接了。

## 各个协议位于那一层？

应用层: ssh，http(tcp), https(tcp), SMTP(tcp), FTP(tcp), dns(udp)
运输层: tcp, udp
网络层: ip
数据链路层：xxxxx

- FTP: 文件传输协议，应用层，底下用的是TCP
- SMTP: 简单文件传输协议，应用层，用于在互联网上发送信息等
- DNS: 应用层协议，将域名转换成ip地址
- TCP/UDP: 传输层
- IP: 网络层
- RIP: 路由信息协议，网络层，用于在计算机网络中交换路由信息
- CSMA/CD: 不懂，载波侦听多路访问/冲突检测 链路层协议，在以太网中控制对共享信道的访问