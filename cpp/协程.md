# 协程

## 普通函数的调用

普通的函数有 call 和 return，调用和返回，这里会有函数栈的创建和相关寄存器的保存。

当一个函数要调用另一个函数的时候，调用者要做好挂起的准备，比如说保存寄存器的数值，CSAPP上有讲，调用者和被调用者会根据协议保存这些寄存器值，然后调用完成之后，会将调用栈摧毁

## 协程的调用

协程的调用也可以分成上面的call 和 return，只不过他能够有三个额外的操作去概括：挂起（Suspend），回复（Resume），销毁（Destroy）

- Suspend：函数的当前点挂起协程的执行，然后执行转移到调用方和恢复方，并不会破坏激活帧，协程只能在协程本身内部的明确定义的挂起点处挂起
- Resume：在挂起的点回复协程的执行，（因为Supend操作并没有破坏函数的调用栈）
- Destory：会销毁激活栈而不恢复协程的执行，

## 函数调用栈

因为挂起之后会执行其他的函数，那么想一想先进先出的这样的栈肯定是不能满足这样的返回（一会儿跑那边，一会儿跑这边），所以说函数调用栈可能是需要存储在堆上的，不过编译器聪明的话，能够保证协程的生命周期严格的嵌套在调用方的生命周期内的话，那么可以避免堆分配